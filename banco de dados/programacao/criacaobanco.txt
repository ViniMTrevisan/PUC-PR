-- entidade central - clinica tera 1 ou varios responsaveis, 
-- table responsavel chamara o ID da clinica - foreign key - 1 responsavel sera responsavel por apenas 1 clinica
-- table medvet - 1 clinica pode ter varios medicos vet e 1 med vet pode trabalhar em varias clinicas
-- mv clinica - foreign key medvet_id e clinica_id
-- consultas so tem 1 medico vet, e 1 consulta tem so 1 paciente, mas 1 med vet pode ter 1 ou varias consultas e os pacientes tambem; 1 clinica pode ter 1 ou vaeias consultas e 1 consulta pertence a apenas 1 clinica
-- tabela central, se eu quero a lista de pacientes a tabela central é a de pacientes, funciona do mesmo jeito com as outras
-- lista quantitativa de medicos tem como entidade centrar mv_clinica
-- pacientes por medico por clinica tem como tabela principal a tabela consulta
-- lista quantitativa por mes e ano por clinica com medidos tem entidade consulta
-- quantitativa de consultas por paciente por medico


CREATE TABLE tb_clinica(
    clinica_id INT PRIMARY KEY AUTO_INCREMENT,
    clinica_nome VARCHAR(50),
    clinica_end VARCHAR(100),
    clinica_site VARCHAR(100),
    clinica_fone VARCHAR(20)
);

CREATE TABLE tb_consulta(
    consulta_id INT PRIMARY KEY AUTO_INCREMENT,
    fk_clinica_id INT,
    fk_consulta_mv INT,
    fk_consulta_pac INT,
    consulta_data DATE,
    consulta_desc VARCHAR(255),
    consulta_hora TIME
    FOREIGN KEY (fk_clinica_id) REFERENCES tb_clinica(clinica_id),
    FOREIGN KEY (fk_consulta_mv) REFERENCES tb_med_vet(med_vet_id),
    FOREIGN KEY (fk_consulta_pac) REFERENCES tb_paciente(pac_id)
);

CREATE TABLE tb_med_vet(
    med_id INT PRIMARY KEY AUTO_INCREMENT,
    med_nome VARCHAR(50),
    med_crmv VARCHAR(20),
    med_cel VARCHAR(20)
);

CREATE TABLE tb_mv_clinica(
    mv_clinica_id INT PRIMARY KEY AUTO_INCREMENT,
    fk_med_vet_id INT,
    fk_clinica_id INT,
    FOREIGN KEY (fk_med_vet_id) REFERENCES tb_med_vet(med_id),
    FOREIGN KEY (fk_clinica_id) REFERENCES tb_clinica(clinica_id)
);

CREATE TABLE tb_paciente(
    pac_id INT PRIMARY KEY AUTO_INCREMENT,
    fk_clinica_id INT,
    pac_nome VARCHAR(50),
    pac_cel VARCHAR(20),
    pac_email VARCHAR(100),
    pac_raca VARCHAR(50),
    pac_tutor VARCHAR(50)
    FOREIGN KEY (fk_clinica_id) REFERENCES tb_clinica(clinica_id)
);

CREATE TABLE tb_responsavel(
    resp_id INT PRIMARY KEY AUTO_INCREMENT,
    fk_clinica_id INT,
    resp_nome VARCHAR(50),
    resp_email VARCHAR(100),
    resp_cel VARCHAR(20),
    resp_crmv VARCHAR(20)
);


INSERT INTO tb_clinica (clinica_nome, clinica_end, clinica_site, clinica_fone) 
VALUES 
('Clinica 1', 'Rua clinica1', 'siteclinica1.com', '(41) 96435-4355'),
('Clinica 2', 'Rua clinica2', 'siteclinica2.com', '(41) 95437-8792'),
('Clinica 3', 'Rua clinica3', 'siteclinica3.com', '(41) 94312-9824');

INSERT INTO tb_med_vet (med_nome, med_cel, med_crmv)
VALUES 
('Dr. Veterinário 1', '(41) 92734-7235', 'CMRV-PR 62734'),
('Dr. Veterinario 2', '(41) 97623-7283', 'CMRV-PR 81794'),
('Dr. Veterinario 3', '(41) 91425-6324', 'CMRV-PR 77591');

INSERT INTO tb_paciente (fk_clinica_id, pac_nome, pac_cel, pac_email, pac_raca, pac_tutor) 
VALUES
(1, 'Paciente 1', '(41) 93872-3274', 'Paciente1@email.com', 'Pitbull', 'Tutor1'),
(2, 'Paciente 2', '(41) 91445-1246', 'Paciente2@email.com', 'Pinscher', 'Tutor2'),
(3, 'Paciente 3', '(41) 93145-6543', 'Paciente3@email.com', 'Dog Alemão', 'Tutor3');

INSERT INTO tb_responsavel(fk_clinica_id, resp_nome, resp_email, resp_cel, resp_crmv)
VALUES
(1, 'Responsavel1', 'Responsavel1@email.com', '(41) 92148-2142', ' CRMV-PR 72145'),
(2, 'Responsavel2', 'Responsavel2@email.com', '(41) 99873-1236', ' CRMV-PR 62355'),
(3, 'Responsavel3', 'Responsavel3@email.com', '(41) 93532-7435', ' CRMV-PR 93245');

INSERT INTO tb_consulta(fk_clinica_id, fk_consulta_mv, fk_consulta_pac, consulta_data, consulta_desc, consulta_hora)
VALUES
(1, 1, 1, '2025-05-15', 'Consulta de acompanhamento', '10:00:00'),
(2, 2, 2, '2025-05-10', 'Check-Up anual', '15:00:00'),
(3, 3, 3, '2025-07-18', 'Consulta de emergência', '08:00:00')

INSERT INTO tb_mv_clinica(fk_med_vet_id, fk_clinica_id)
VALUES
(1, 1),
(2, 2),
(3, 3)

SELECT * FROM tb_clinica;
SELECT * FROM tb_med_vet;
SELECT * FROM tb_paciente;
SELECT * FROM tb_responsavel;
SELECT * FROM tb_consulta;


CREATE VIEW vw_lista_pacientes
AS 
SELECT clinica_id, pac_id,
pac_nome, pac_raca,
clinica_nome
FROM tb_paciente
LEFT JOIN tb_clinica ON fk_clinica_id = clinica_id

CREATE VIEW vw_lista_consultas
AS
SELECT clinica_id, consulta_id, 
consulta_data, consulta_desc, consulta_hora,
clinica_nome
FROM tb_consulta
LEFT JOIN tb_clinica on fk_clinica_id = clinica_id

CREATE VIEW vw_med_por_clinica
AS
SELECT clinica_id, 
clinica_nome, 
med_id, med_nome,
COUNT(tb_mv_clinica.fk_med_vet_id) AS qnt_med
FROM tb_clinica
LEFT JOIN tb_mv_clinica ON tb_clinica.clinica_id = tb_mv_clinica.fk_clinica_id
GROUP BY tb_clinica.clinica_id, tb_clinica.clinica_nome;

CREATE VIEW vw_pac_med_clinica
AS
SELECT clinica_id, med_id, pac_id,
clinica_nome, med_nome, pac_nome,
COUNT(tb_paciente.pac_id) AS qnt_pac
FROM tb_clinica
LEFT JOIN tb_mv_clinica ON tb_clinica.clinica_id = tb_mv_clinica.fk_clinica_id
LEFT JOIN tb_med_vet ON tb_mv_clinica.fk_med_vet_id = tb_med_vet.med_id
LEFT JOIN tb_paciente ON tb_clinica.clinica_id = tb_paciente.fk_clinica_id
GROUP BY tb_clinica.clinica_id, tb_clinica.clinica_nome
